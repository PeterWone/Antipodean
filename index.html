<html>

<head>
  <title>Antipodean</title>
  <link href="./md.css" rel="stylesheet">
</head>

<body>
  <div id="toc">
    <h2>Table of Contents</h2>
    <ul id="markdown-links"></ul>
  </div>
  <div id="content"></div>
  <div id="hidden-content" style="display: none;"></div> <!-- Hidden div for temporary content -->

  <script>
    // Fetch markdown files from the GitHub repository and link to GitHub Pages
    const repoUrl = "https://api.github.com/repos/PeterWone/Antipodean/contents/";
    const githubPagesBaseUrl = "https://peterwone.github.io/Antipodean/";
    const toc = document.getElementById('markdown-links');
    const content = document.getElementById('content');
    const hiddenContent = document.getElementById('hidden-content');

    async function fetchMarkdownFiles() {
      try {
        const response = await fetch(repoUrl);
        const files = await response.json();
        const markdownFiles = files.filter(file => file.name.endsWith('.md')).sort((a, b) => a.name.localeCompare(b.name));

        markdownFiles.forEach(file => {
          const listItem = document.createElement('li');
          const link = document.createElement('a');
          link.href = "#";
          link.textContent = file.name
            .replace(/\.md$/, '') // Remove extension
            .replace(/\.(?=[a-zA-Z])/g, ' ') // Period followed by a letter becomes a space
            .replace(/-/g, ' '); // Replace dashes with spaces
          link.addEventListener('click', (e) => {
            e.preventDefault();
            loadContent(file.name);
          });
          listItem.appendChild(link);
          toc.appendChild(listItem);
        });

        // Preselect the blurb (first chapter file alphabetically)
        if (markdownFiles.length > 0) {
          loadContent(markdownFiles[0].name);
        }
      } catch (error) {
        console.error("Error fetching markdown files:", error);
      }
    }

    async function loadContent(fileName) {
      try {
        const response = await fetch(githubPagesBaseUrl + fileName.replace(/\.md$/, '.html'));
        const html = await response.text();
        hiddenContent.innerHTML = html; // Load content into the hidden div
        const markdownBody = hiddenContent.querySelector('.markdown-body'); // Look for the div with class markdown-body
        content.innerHTML = markdownBody ? markdownBody.innerHTML : '<p>Content not found.</p>'; // Extract and set content
        hiddenContent.innerHTML = ''; // Clear the hidden div
      } catch (error) {
        console.error("Error loading content:", error);
      }
    }

    fetchMarkdownFiles();
  </script>

  <script src="js/smartquotes.min.js"></script>
  <script>smartquotes();</script>
</body>

</html>